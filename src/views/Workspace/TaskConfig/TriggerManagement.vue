<template>
  <div class="trigger-management">
    <div class="page-header">
      <h2>Ëß¶ÂèëÂô®Á±ªÂûãÁÆ°ÁêÜ</h2>
      <el-button type="primary" @click="showCreateDialog = true">
        <i class="el-icon-plus"></i>
        Êñ∞Âª∫Ëß¶ÂèëÂô®Á±ªÂûã
      </el-button>
    </div>

    <div class="content-area">
      <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâ -->
      <div class="search-bar">
        <el-row :gutter="20">
          <el-col :span="8">
            <el-input
                v-model="searchQuery"
                placeholder="ÊêúÁ¥¢Ëß¶ÂèëÂô®ÂêçÁß∞ÊàñÊèèËø∞"
                clearable
                @input="handleSearch"
            >
              <template #prefix>
                <i class="el-icon-search"></i>
              </template>
            </el-input>
          </el-col>
          <el-col :span="6">
            <el-select
                v-model="statusFilter"
                placeholder="Áä∂ÊÄÅÁ≠õÈÄâ"
                clearable
                @change="handleSearch"
            >
              <el-option label="ÂêØÁî®" value="enabled" />
              <el-option label="Á¶ÅÁî®" value="disabled" />
            </el-select>
          </el-col>
          <el-col :span="6">
            <el-select
                v-model="categoryFilter"
                placeholder="ÂàÜÁ±ªÁ≠õÈÄâ"
                clearable
                @change="handleSearch"
            >
              <el-option label="Êó∂Èó¥Á±ª" value="time" />
              <el-option label="‰∫ã‰ª∂Á±ª" value="event" />
              <el-option label="Êù°‰ª∂Á±ª" value="condition" />
              <el-option label="Ëá™ÂÆö‰πâ" value="custom" />
            </el-select>
          </el-col>
        </el-row>
      </div>

      <!-- Ëß¶ÂèëÂô®ÂàóË°® -->
      <div class="trigger-grid">
        <div
            v-for="trigger in filteredTriggers"
            :key="trigger.id"
            class="trigger-card"
            :class="{ 'disabled': !trigger.enabled }"
        >
          <div class="card-header">
            <div class="trigger-info">
              <h3 class="trigger-name">{{ trigger.name }}</h3>
              <span class="trigger-category" :class="trigger.category">
                {{ getCategoryName(trigger.category) }}
              </span>
            </div>
            <div class="card-actions">
              <el-switch
                  v-model="trigger.enabled"
                  @change="toggleTriggerStatus(trigger)"
                  :disabled="trigger.system"
              />
              <el-dropdown @command="handleAction">
                <el-button type="text" size="small">
                  <i class="el-icon-more"></i>
                </el-button>
                <template #dropdown>
                  <el-dropdown-menu>
                    <el-dropdown-item
                        :command="{ action: 'edit', trigger }"
                        :disabled="trigger.system"
                    >
                      ÁºñËæë
                    </el-dropdown-item>
                    <el-dropdown-item
                        :command="{ action: 'duplicate', trigger }"
                    >
                      Â§çÂà∂
                    </el-dropdown-item>
                    <el-dropdown-item
                        :command="{ action: 'delete', trigger }"
                        :disabled="trigger.system"
                        style="color: #f56c6c;"
                    >
                      Âà†Èô§
                    </el-dropdown-item>
                  </el-dropdown-menu>
                </template>
              </el-dropdown>
            </div>
          </div>

          <div class="card-content">
            <p class="trigger-description">{{ trigger.description }}</p>

            <div class="trigger-details">
              <div class="detail-section">
                <h4>Ëß¶ÂèëÊù°‰ª∂ÈÖçÁΩÆ</h4>
                <div class="config-preview">
                  <el-tag
                      v-for="field in trigger.configFields.slice(0, 3)"
                      :key="field.key"
                      size="small"
                      effect="plain"
                  >
                    {{ field.label }}
                  </el-tag>
                  <span v-if="trigger.configFields.length > 3" class="more-fields">
                    +{{ trigger.configFields.length - 3 }}È°π
                  </span>
                </div>
              </div>

              <div class="detail-section">
                <h4>‰ΩøÁî®ÁªüËÆ°</h4>
                <div class="usage-stats">
                  <span class="stat-item">
                    <i class="el-icon-link"></i>
                    {{ trigger.usageCount || 0 }} ‰∏™ËøûÁ∫ø‰ΩøÁî®
                  </span>
                  <span class="stat-item">
                    <i class="el-icon-time"></i>
                    {{ formatDate(trigger.lastUsed) }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <div class="system-badge" v-if="trigger.system">
              <i class="el-icon-lock"></i>
              Á≥ªÁªüÂÜÖÁΩÆ
            </div>
            <div class="create-info">
              ÂàõÂª∫‰∫é {{ formatDate(trigger.createdAt) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Á©∫Áä∂ÊÄÅ -->
      <div v-if="filteredTriggers.length === 0" class="empty-state">
        <i class="el-icon-info"></i>
        <p>ÊöÇÊó†Ëß¶ÂèëÂô®Á±ªÂûã</p>
        <el-button type="primary" @click="showCreateDialog = true">
          ÂàõÂª∫Á¨¨‰∏Ä‰∏™Ëß¶ÂèëÂô®Á±ªÂûã
        </el-button>
      </div>
    </div>

    <!-- ÂàõÂª∫/ÁºñËæëÂØπËØùÊ°Ü -->
    <el-dialog
        v-model="showCreateDialog"
        :title="editMode ? 'ÁºñËæëËß¶ÂèëÂô®Á±ªÂûã' : 'Êñ∞Âª∫Ëß¶ÂèëÂô®Á±ªÂûã'"
        width="800px"
        :close-on-click-modal="false"
    >
      <el-form
          ref="triggerForm"
          :model="currentTrigger"
          :rules="formRules"
          label-width="120px"
      >
        <el-row :gutter="20">
          <el-col :span="12">
            <el-form-item label="Ëß¶ÂèëÂô®ÂêçÁß∞" prop="name">
              <el-input
                  v-model="currentTrigger.name"
                  placeholder="ËØ∑ËæìÂÖ•Ëß¶ÂèëÂô®ÂêçÁß∞"
                  maxlength="50"
                  show-word-limit
              />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ÂàÜÁ±ª" prop="category">
              <el-select v-model="currentTrigger.category" placeholder="ÈÄâÊã©ÂàÜÁ±ª">
                <el-option label="Êó∂Èó¥Á±ª" value="time" />
                <el-option label="‰∫ã‰ª∂Á±ª" value="event" />
                <el-option label="Êù°‰ª∂Á±ª" value="condition" />
                <el-option label="Ëá™ÂÆö‰πâ" value="custom" />
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>

        <el-form-item label="ÊèèËø∞" prop="description">
          <el-input
              v-model="currentTrigger.description"
              type="textarea"
              :rows="3"
              placeholder="ËØ∑ËæìÂÖ•Ëß¶ÂèëÂô®ÊèèËø∞"
              maxlength="200"
              show-word-limit
          />
        </el-form-item>

        <el-form-item label="ÂõæÊ†á">
          <el-select v-model="currentTrigger.icon" placeholder="ÈÄâÊã©ÂõæÊ†á">
            <el-option label="‚è∞ Êó∂Èíü" value="clock" />
            <el-option label="‚ö° Èó™Áîµ" value="lightning" />
            <el-option label="üîî ÈìÉÈìõ" value="bell" />
            <el-option label="üéØ ÁõÆÊ†á" value="target" />
            <el-option label="‚öôÔ∏è ËÆæÁΩÆ" value="settings" />
          </el-select>
        </el-form-item>

        <el-form-item label="ÈÖçÁΩÆÂ≠óÊÆµ">
          <div class="config-fields-editor">
            <div
                v-for="(field, index) in currentTrigger.configFields"
                :key="index"
                class="field-item"
            >
              <el-row :gutter="10">
                <el-col :span="6">
                  <el-input
                      v-model="field.key"
                      placeholder="Â≠óÊÆµÊ†áËØÜ"
                      size="small"
                  />
                </el-col>
                <el-col :span="6">
                  <el-input
                      v-model="field.label"
                      placeholder="Â≠óÊÆµÊ†áÁ≠æ"
                      size="small"
                  />
                </el-col>
                <el-col :span="4">
                  <el-select v-model="field.type" placeholder="Á±ªÂûã" size="small">
                    <el-option label="ÊñáÊú¨" value="text" />
                    <el-option label="Êï∞Â≠ó" value="number" />
                    <el-option label="ÈÄâÊã©" value="select" />
                    <el-option label="ÂºÄÂÖ≥" value="switch" />
                    <el-option label="Êó•Êúü" value="date" />
                  </el-select>
                </el-col>
                <el-col :span="4">
                  <el-checkbox v-model="field.required" size="small">
                    ÂøÖÂ°´
                  </el-checkbox>
                </el-col>
                <el-col :span="4">
                  <el-button
                      @click="removeConfigField(index)"
                      size="small"
                      type="danger"
                      icon="el-icon-delete"
                  />
                </el-col>
              </el-row>

              <!-- ÈÄâÊã©Á±ªÂûãÁöÑÈÄâÈ°πÈÖçÁΩÆ -->
              <div v-if="field.type === 'select'" class="field-options">
                <el-tag
                    v-for="(option, optIndex) in field.options"
                    :key="optIndex"
                    closable
                    @close="removeFieldOption(index, optIndex)"
                    size="small"
                >
                  {{ option }}
                </el-tag>
                <el-input
                    v-model="newOptionValue"
                    placeholder="Ê∑ªÂä†ÈÄâÈ°π"
                    size="small"
                    style="width: 120px; margin-left: 8px;"
                    @keyup.enter="addFieldOption(index)"
                />
                <el-button
                    @click="addFieldOption(index)"
                    size="small"
                    type="primary"
                    icon="el-icon-plus"
                />
              </div>
            </div>

            <el-button
                @click="addConfigField"
                type="dashed"
                icon="el-icon-plus"
                style="width: 100%; margin-top: 10px;"
            >
              Ê∑ªÂä†ÈÖçÁΩÆÂ≠óÊÆµ
            </el-button>
          </div>
        </el-form-item>

        <el-form-item label="ÊâßË°åËÑöÊú¨">
          <div class="script-editor">
            <el-input
                v-model="currentTrigger.script"
                type="textarea"
                :rows="8"
                placeholder="ËØ∑ËæìÂÖ•Ëß¶ÂèëÂô®ÊâßË°åÈÄªËæëÁöÑJavaScript‰ª£Á†Å..."
            />
            <div class="script-help">
              <el-alert
                  title="ËÑöÊú¨ËØ¥Êòé"
                  type="info"
                  :closable="false"
                  show-icon
              >
                <template #default>
                  <p>ÂèØÁî®ÂèòÈáèÔºö</p>
                  <ul>
                    <li><code>state</code>: ÂΩìÂâçÁä∂ÊÄÅÂØπË±°</li>
                    <li><code>config</code>: Ëß¶ÂèëÂô®ÈÖçÁΩÆÂèÇÊï∞</li>
                    <li><code>context</code>: Â∑•‰ΩúÊµÅ‰∏ä‰∏ãÊñá</li>
                  </ul>
                  <p>ËøîÂõû <code>true</code> Ë°®Á§∫Ëß¶ÂèëÊù°‰ª∂Êª°Ë∂≥</p>
                </template>
              </el-alert>
            </div>
          </div>
        </el-form-item>
      </el-form>

      <template #footer>
        <el-button @click="showCreateDialog = false">ÂèñÊ∂à</el-button>
        <el-button @click="resetForm">ÈáçÁΩÆ</el-button>
        <el-button type="primary" @click="saveTrigger" :loading="saving">
          {{ editMode ? '‰øùÂ≠ò' : 'ÂàõÂª∫' }}
        </el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const searchQuery = ref('')
const statusFilter = ref('')
const categoryFilter = ref('')
const showCreateDialog = ref(false)
const editMode = ref(false)
const saving = ref(false)
const newOptionValue = ref('')

// Ë°®ÂçïÂºïÁî®
const triggerForm = ref(null)

// Ëß¶ÂèëÂô®Êï∞ÊçÆ
const triggers = ref([
  {
    id: 1,
    name: 'ÂÆöÊó∂Ëß¶ÂèëÂô®',
    description: 'Âü∫‰∫éÊó∂Èó¥Èó¥ÈöîÊàñÁâπÂÆöÊó∂Èó¥ÁÇπËß¶ÂèëÁä∂ÊÄÅËøÅÁßª',
    category: 'time',
    icon: 'clock',
    enabled: true,
    system: true,
    usageCount: 5,
    lastUsed: new Date('2024-06-01'),
    createdAt: new Date('2024-01-01'),
    configFields: [
      { key: 'interval', label: 'Êó∂Èó¥Èó¥Èöî', type: 'number', required: true },
      { key: 'unit', label: 'Êó∂Èó¥Âçï‰Ωç', type: 'select', options: ['Áßí', 'ÂàÜÈíü', 'Â∞èÊó∂', 'Â§©'], required: true },
      { key: 'startTime', label: 'ÂºÄÂßãÊó∂Èó¥', type: 'date', required: false }
    ],
    script: `
// ÂÆöÊó∂Ëß¶ÂèëÂô®ÈÄªËæë
const now = new Date();
const startTime = new Date(config.startTime || state.createdAt);
const intervalMs = config.interval * getIntervalMultiplier(config.unit);

return now - startTime >= intervalMs;

function getIntervalMultiplier(unit) {
  const multipliers = {
    'Áßí': 1000,
    'ÂàÜÈíü': 60 * 1000,
    'Â∞èÊó∂': 60 * 60 * 1000,
    'Â§©': 24 * 60 * 60 * 1000
  };
  return multipliers[unit] || 1000;
}
    `
  },
  {
    id: 2,
    name: '‰∫ã‰ª∂Ëß¶ÂèëÂô®',
    description: 'ÂìçÂ∫îÁâπÂÆö‰∫ã‰ª∂Ëß¶ÂèëÁä∂ÊÄÅËøÅÁßª',
    category: 'event',
    icon: 'lightning',
    enabled: true,
    system: true,
    usageCount: 3,
    lastUsed: new Date('2024-05-15'),
    createdAt: new Date('2024-01-15'),
    configFields: [
      { key: 'eventType', label: '‰∫ã‰ª∂Á±ªÂûã', type: 'select', options: ['Áî®Êà∑Êìç‰Ωú', 'Á≥ªÁªü‰∫ã‰ª∂', 'Â§ñÈÉ®API'], required: true },
      { key: 'eventName', label: '‰∫ã‰ª∂ÂêçÁß∞', type: 'text', required: true },
      { key: 'timeout', label: 'Ë∂ÖÊó∂Êó∂Èó¥(Áßí)', type: 'number', required: false }
    ],
    script: `
// ‰∫ã‰ª∂Ëß¶ÂèëÂô®ÈÄªËæë
const targetEvent = config.eventName;
const recentEvents = context.events || [];

// Ê£ÄÊü•ÊúÄËøëÊòØÂê¶ÊúâÂåπÈÖçÁöÑ‰∫ã‰ª∂
const matchingEvent = recentEvents.find(event =>
  event.type === config.eventType &&
  event.name === targetEvent &&
  event.timestamp > state.lastCheckTime
);

return !!matchingEvent;
    `
  },
  {
    id: 3,
    name: 'Êù°‰ª∂Ëß¶ÂèëÂô®',
    description: 'Âü∫‰∫éÁä∂ÊÄÅÂ±ûÊÄßÊù°‰ª∂Âà§Êñ≠Ëß¶ÂèëÁä∂ÊÄÅËøÅÁßª',
    category: 'condition',
    icon: 'target',
    enabled: true,
    system: false,
    usageCount: 8,
    lastUsed: new Date('2024-06-05'),
    createdAt: new Date('2024-02-01'),
    configFields: [
      { key: 'attribute', label: 'ÁõëÊéßÂ±ûÊÄß', type: 'text', required: true },
      { key: 'operator', label: 'ÊØîËæÉÊìç‰Ωú', type: 'select', options: ['Á≠â‰∫é', '‰∏çÁ≠â‰∫é', 'Â§ß‰∫é', 'Â∞è‰∫é', 'ÂåÖÂê´'], required: true },
      { key: 'value', label: 'ÁõÆÊ†áÂÄº', type: 'text', required: true },
      { key: 'checkInterval', label: 'Ê£ÄÊü•Èó¥Èöî(Áßí)', type: 'number', required: false }
    ],
    script: `
// Êù°‰ª∂Ëß¶ÂèëÂô®ÈÄªËæë
const attributeValue = state.attributes[config.attribute];
const targetValue = config.value;

switch(config.operator) {
  case 'Á≠â‰∫é':
    return attributeValue == targetValue;
  case '‰∏çÁ≠â‰∫é':
    return attributeValue != targetValue;
  case 'Â§ß‰∫é':
    return Number(attributeValue) > Number(targetValue);
  case 'Â∞è‰∫é':
    return Number(attributeValue) < Number(targetValue);
  case 'ÂåÖÂê´':
    return String(attributeValue).includes(targetValue);
  default:
    return false;
}
    `
  }
])

// ÂΩìÂâçÁºñËæëÁöÑËß¶ÂèëÂô®
const currentTrigger = ref({
  name: '',
  description: '',
  category: '',
  icon: '',
  enabled: true,
  system: false,
  configFields: [],
  script: ''
})

// Ë°®ÂçïÈ™åËØÅËßÑÂàô
const formRules = {
  name: [
    { required: true, message: 'ËØ∑ËæìÂÖ•Ëß¶ÂèëÂô®ÂêçÁß∞', trigger: 'blur' },
    { min: 2, max: 50, message: 'ÈïøÂ∫¶Âú® 2 Âà∞ 50 ‰∏™Â≠óÁ¨¶', trigger: 'blur' }
  ],
  category: [
    { required: true, message: 'ËØ∑ÈÄâÊã©ÂàÜÁ±ª', trigger: 'change' }
  ],
  description: [
    { required: true, message: 'ËØ∑ËæìÂÖ•ÊèèËø∞', trigger: 'blur' },
    { max: 200, message: 'ÊèèËø∞‰∏çËÉΩË∂ÖËøá200‰∏™Â≠óÁ¨¶', trigger: 'blur' }
  ]
}

// ËÆ°ÁÆóÂ±ûÊÄß
const filteredTriggers = computed(() => {
  let result = triggers.value

  if (searchQuery.value) {
    const query = searchQuery.value.toLowerCase()
    result = result.filter(trigger =>
        trigger.name.toLowerCase().includes(query) ||
        trigger.description.toLowerCase().includes(query)
    )
  }

  if (statusFilter.value) {
    result = result.filter(trigger =>
        statusFilter.value === 'enabled' ? trigger.enabled : !trigger.enabled
    )
  }

  if (categoryFilter.value) {
    result = result.filter(trigger => trigger.category === categoryFilter.value)
  }

  return result
})

// ÊñπÊ≥ï
const getCategoryName = (category) => {
  const names = {
    'time': 'Êó∂Èó¥Á±ª',
    'event': '‰∫ã‰ª∂Á±ª',
    'condition': 'Êù°‰ª∂Á±ª',
    'custom': 'Ëá™ÂÆö‰πâ'
  }
  return names[category] || category
}

const formatDate = (date) => {
  if (!date) return 'Êú™‰ΩøÁî®'
  return date.toLocaleDateString('zh-CN')
}

const handleSearch = () => {
  // ÊêúÁ¥¢ÈÄªËæëÂ∑≤ÈÄöËøáËÆ°ÁÆóÂ±ûÊÄßÂÆûÁé∞
}

const toggleTriggerStatus = (trigger) => {
  ElMessage.success(`Ëß¶ÂèëÂô®Â∑≤${trigger.enabled ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}`)
}

const handleAction = ({ action, trigger }) => {
  switch (action) {
    case 'edit':
      editTrigger(trigger)
      break
    case 'duplicate':
      duplicateTrigger(trigger)
      break
    case 'delete':
      deleteTrigger(trigger)
      break
  }
}

const editTrigger = (trigger) => {
  currentTrigger.value = JSON.parse(JSON.stringify(trigger))
  editMode.value = true
  showCreateDialog.value = true
}

const duplicateTrigger = (trigger) => {
  const duplicated = JSON.parse(JSON.stringify(trigger))
  duplicated.id = Date.now()
  duplicated.name = trigger.name + ' - ÂâØÊú¨'
  duplicated.system = false
  duplicated.usageCount = 0
  duplicated.lastUsed = null
  duplicated.createdAt = new Date()

  triggers.value.push(duplicated)
  ElMessage.success('Ëß¶ÂèëÂô®Â§çÂà∂ÊàêÂäü')
}

const deleteTrigger = async (trigger) => {
  if (trigger.usageCount > 0) {
    ElMessage.warning('ËØ•Ëß¶ÂèëÂô®Ê≠£Âú®Ë¢´‰ΩøÁî®ÔºåÊó†Ê≥ïÂà†Èô§')
    return
  }

  try {
    await ElMessageBox.confirm(
        `Á°ÆÂÆöË¶ÅÂà†Èô§Ëß¶ÂèëÂô®"${trigger.name}"ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`,
        'Á°ÆËÆ§Âà†Èô§',
        { type: 'warning' }
    )

    triggers.value = triggers.value.filter(t => t.id !== trigger.id)
    ElMessage.success('Ëß¶ÂèëÂô®Âà†Èô§ÊàêÂäü')
  } catch {
    // Áî®Êà∑ÂèñÊ∂àÂà†Èô§
  }
}

const addConfigField = () => {
  currentTrigger.value.configFields.push({
    key: '',
    label: '',
    type: 'text',
    required: false,
    options: []
  })
}

const removeConfigField = (index) => {
  currentTrigger.value.configFields.splice(index, 1)
}

const addFieldOption = (fieldIndex) => {
  if (newOptionValue.value.trim()) {
    if (!currentTrigger.value.configFields[fieldIndex].options) {
      currentTrigger.value.configFields[fieldIndex].options = []
    }
    currentTrigger.value.configFields[fieldIndex].options.push(newOptionValue.value.trim())
    newOptionValue.value = ''
  }
}

const removeFieldOption = (fieldIndex, optionIndex) => {
  currentTrigger.value.configFields[fieldIndex].options.splice(optionIndex, 1)
}

const resetForm = () => {
  currentTrigger.value = {
    name: '',
    description: '',
    category: '',
    icon: '',
    enabled: true,
    system: false,
    configFields: [],
    script: ''
  }
  triggerForm.value?.clearValidate()
}

const saveTrigger = async () => {
  try {
    await triggerForm.value.validate()
    saving.value = true

    // Ê®°Êãü‰øùÂ≠òÂª∂Ëøü
    await new Promise(resolve => setTimeout(resolve, 1000))

    if (editMode.value) {
      const index = triggers.value.findIndex(t => t.id === currentTrigger.value.id)
      if (index !== -1) {
        triggers.value[index] = { ...currentTrigger.value }
      }
      ElMessage.success('Ëß¶ÂèëÂô®Êõ¥Êñ∞ÊàêÂäü')
    } else {
      const newTrigger = {
        ...currentTrigger.value,
        id: Date.now(),
        usageCount: 0,
        lastUsed: null,
        createdAt: new Date()
      }
      triggers.value.push(newTrigger)
      ElMessage.success('Ëß¶ÂèëÂô®ÂàõÂª∫ÊàêÂäü')
    }

    showCreateDialog.value = false
    editMode.value = false
    resetForm()
  } catch (error) {
    console.error('Ë°®ÂçïÈ™åËØÅÂ§±Ë¥•:', error)
  } finally {
    saving.value = false
  }
}

// ÁîüÂëΩÂë®Êúü
onMounted(() => {
  // ÂàùÂßãÂåñÈÄªËæë
})
</script>

<style scoped>
.trigger-management {
  padding: 24px;
  background-color: #f5f7fa;
  min-height: 100vh;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.page-header h2 {
  margin: 0;
  color: #303133;
  font-size: 24px;
  font-weight: 600;
}

.content-area {
  background: white;
  border-radius: 8px;
  padding: 24px;
}

.search-bar {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid #ebeef5;
}

.trigger-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  gap: 20px;
}

.trigger-card {
  border: 1px solid #ebeef5;
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s ease;
  background: white;
}

.trigger-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-color: #409eff;
}

.trigger-card.disabled {
  opacity: 0.6;
}

.card-header {
  padding: 16px 20px;
  background: #fafbfc;
  border-bottom: 1px solid #ebeef5;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.trigger-info h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: #303133;
}

.trigger-category {
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 12px;
  color: white;
}

.trigger-category.time {
  background-color: #409eff;
}

.trigger-category.event {
  background-color: #67c23a;
}

.trigger-category.condition {
  background-color: #e6a23c;
}

.trigger-category.custom {
  background-color: #909399;
}

.card-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.card-content {
  padding: 20px;
}

.trigger-description {
  margin: 0 0 16px 0;
  color: #606266;
  line-height: 1.5;
}

.trigger-details {
  margin-bottom: 16px;
}

.detail-section {
  margin-bottom: 16px;
}

.detail-section:last-child {
  margin-bottom: 0;
}

.detail-section h4 {
  margin: 0 0 8px 0;
  font-size: 14px;
  font-weight: 600;
  color: #303133;
}

.config-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}

.more-fields {
  font-size: 12px;
  color: #909399;
}

.usage-stats {
  display: flex;
  gap: 16px;
}

.stat-item {
  font-size: 12px;
  color: #606266;
  display: flex;
  align-items: center;
  gap: 4px;
}

.card-footer {
  padding: 12px 20px;
  background: #fafbfc;
  border-top: 1px solid #ebeef5;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: #909399;
}

.system-badge {
  display: flex;
  align-items: center;
  gap: 4px;
  color: #e6a23c;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #909399;
}

.empty-state i {
  font-size: 48px;
  margin-bottom: 16px;
  display: block;
}

.config-fields-editor {
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  padding: 16px;
  background: #fafbfc;
}

.field-item {
  margin-bottom: 16px;
  padding: 12px;
  background: white;
  border-radius: 4px;
  border: 1px solid #ebeef5;
}

.field-item:last-child {
  margin-bottom: 0;
}

.field-options {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid #ebeef5;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px;
}

.script-editor {
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  overflow: hidden;
}

.script-help {
  padding: 12px;
  background: #f8f9fa;
  border-top: 1px solid #ebeef5;
}

.script-help ul {
  margin: 8px 0;
  padding-left: 20px;
}

.script-help code {
  background: #e4e7ed;
  padding: 2px 4px;
  border-radius: 2px;
  font-size: 12px;
}
</style>